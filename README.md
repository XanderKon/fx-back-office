## Приложение "Конвертер валют"

Понадобится docker, docker compose

В корне проекта лежит Makefile, который предоставляет некий фасад для основных команд. Лучше использовать его.

---

### Чтобы запустить проект:

- Выполняем `make run`, ждём когда образы соберутся и запустятся контейнеры (займет какое-то время);
- Выполняем `make composer`;
- Выполняем `make migrate`, затем: http://localhost:8080/;

Будет также собран контейнер с фронтендом, однако для полноценной работы конвертера необходимо предварительно запустить
скрипт импорта котировок (о нём ниже).

*P.S. При запуске миграций база также будет просидирована начальными значениями с источниками котировок. Из-за спорного
дизайна системы без этого скрипт импорта котировок работать не будет.*

Чтобы запустить проект без Makefile: [инструкция](doc/manualSetup.md)

---

### Консольные команды

1. Импорт котировок (запускать из директории `docker/`)

    ```bash
    docker compose exec --user=www-data php-fpm bin/console app:import-rate
    ````
  
    Команда выполнит импорт из всех активных источников, для которых реализован соответствующий Провайдер. Также команда
    проверяет "активность" источника: соответствующий параметр хранится в базе в таблице source (**is_active**).

2. Конвертация валют (запускать из директории `docker/`)

    ```bash
    docker compose exec --user=www-data php-fpm bin/console app:exchange 100.5 EUR BTC
    ````

    Команда принимает три аргумента:

    - количество обмениваемой валюты;
    - исходная валюта;
    - валюта для конвертации.

    Поддерживаются любые валюты, которые хранятся в базе в таблице **rate**. Курс
    конвертации необязательно должен быть прямым, система сама найдет оптимальный путь
    через те валюты, которые есть в распоряжении. Схема работы основана на алгоритме
    [BFS](https://ru.wikipedia.org/wiki/%D0%9F%D0%BE%D0%B8%D1%81%D0%BA_%D0%B2_%D1%88%D0%B8%D1%80%D0%B8%D0%BD%D1%83).

    В системе реализован также алгоритм [Дейкстры](https://ru.wikipedia.org/wiki/%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC_%D0%94%D0%B5%D0%B9%D0%BA%D1%81%D1%82%D1%80%D1%8B), 
    однако его применение в данной задаче представляется нецелесообразным. 

    В случае если несколько разных источников предоставляют свои курсы конвертации, будет
    рассчитан путь с самыми "дешевыми" весами (что, впрочем, не означает самый выгодный курс в общем случае).

---

### Полезные команды

- Запуск всех линтеров и анализаторов разом:

  ```bash
  make lint
  ```

- Запуск PHPStan

  ```bash
  make stan
  ```

- Запуск PHP CS Fixer

  ```bash
  make phpcs
  ```

- Запуск Psalm

  ```bash
  make psalm
  ```
